    q = (request.args.get("q", "") or "").strip()
    project = (request.args.get("project", "") or "").strip()
    week = (request.args.get("week", "") or "").strip()
    owner = (request.args.get("owner", "") or "").strip()
    report_type = (request.args.get("report_type", "") or "").strip()
    from_date = (request.args.get("from_date", "") or "").strip()
    to_date = (request.args.get("to_date", "") or "").strip()

    sql = """
        SELECT r.*, COUNT(f.id) AS file_count
        FROM reports r
        LEFT JOIN report_files f ON f.report_id = r.report_id
        WHERE 1=1
    """
    params = []

    if q:
        sql += " AND (r.report_id LIKE ? OR r.project LIKE ? OR r.owner LIKE ? OR r.report_type LIKE ?)"
        like = f"%{q}%"
        params += [like, like, like, like]

    if project:
        sql += " AND r.project = ?"
        params.append(project)

    if week:
        sql += " AND r.week = ?"
        params.append(week)

    if owner:
        sql += " AND r.owner = ?"
        params.append(owner)

    if report_type:
        sql += " AND r.report_type = ?"
        params.append(report_type)

    # IMPORTANT: Dates must be in YYYY-MM-DD format in the UI input
    if from_date:
        sql += " AND date(r.updated_at) >= date(?)"
        params.append(from_date)

    if to_date:
        sql += " AND date(r.updated_at) <= date(?)"
        params.append(to_date)

    sql += " GROUP BY r.report_id ORDER BY r.updated_at DESC"

    with connect() as c:
        reports = c.execute(sql, params).fetchall()

        projects = [r["project"] for r in c.execute("SELECT DISTINCT project FROM reports ORDER BY project")]
        weeks = [r["week"] for r in c.execute("SELECT DISTINCT week FROM reports ORDER BY week")]
        owners = [r["owner"] for r in c.execute("SELECT DISTINCT owner FROM reports ORDER BY owner")]
        types = [r["report_type"] for r in c.execute("SELECT DISTINCT report_type FROM reports ORDER BY report_type")]

    return render_template(
        "dashboard.html",
        reports=reports,
        projects=projects,
        weeks=weeks,
        owners=owners,
        types=types,
        q=q,
        project=project,
        week=week,
        owner=owner,
        report_type=report_type,
        from_date=from_date,
        to_date=to_date,
    )
